"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var geolocation = require("nativescript-geolocation");
var constants = require("./common/constants");
var requestor = require("./common/requestor");
var locationStore = require("./stores/locationStore");
var utilities = require("./common/utilities");
var moment = require("moment");
var HelloWorldModel = /** @class */ (function (_super) {
    __extends(HelloWorldModel, _super);
    function HelloWorldModel() {
        var _this = _super.call(this) || this;
        if (!geolocation.isEnabled()) {
            geolocation.enableLocationRequest();
        }
        var time_of_day = utilities.getTimeOfDay();
        _this.set('background_class', time_of_day);
        _this.setIcons();
        var location = geolocation.getCurrentLocation({ timeout: 10000 }).
            then(function (loc) {
            if (loc) {
                locationStore.saveLocation(loc);
                _this.set('is_loading', true);
                var url = "" + constants.WEATHER_URL + constants.CURRENT_WEATHER_PATH + "?lat=" + loc.latitude + "&lon=" + loc.longitude + "&apikey=" + constants.WEATHER_APIKEY;
                requestor.get(url).then(function (res) {
                    _this.set('is_loading', false);
                    var weather = res.weather[0].main.toLowerCase();
                    var weather_description = res.weather[0].description;
                    var temperature = (res.main.temp) - 273.15;
                    var icon = constants.WEATHER_ICONS[time_of_day][weather];
                    var rain = '0';
                    if (res.rain) {
                        rain = res.rain['3h'];
                    }
                    _this.set('icon', String.fromCharCode(icon));
                    _this.set('temperature', utilities.describeTemperature(Math.floor(temperature)) + " (" + utilities.convertKelvinToCelsius(temperature).toFixed(2) + " \u00B0C)");
                    _this.set('weather', weather_description);
                    _this.set('place', res.name + ", " + res.sys.country);
                    _this.set('wind', utilities.describeWindSpeed(res.wind.speed) + " " + res.wind.speed + "m/s " + utilities.degreeToDirection(res.wind.deg) + " (" + res.wind.deg + "\u00B0)");
                    _this.set('clouds', res.clouds.all + "%");
                    _this.set('pressure', res.main.pressure + " hpa");
                    _this.set('humidity', utilities.describeHumidity(res.main.humidity) + " (" + res.main.humidity + "%)");
                    _this.set('rain', rain + "%");
                    _this.set('sunrise', moment.unix(res.sys.sunrise).format('hh:mm a'));
                    _this.set('sunset', moment.unix(res.sys.sunset).format('hh:mm a'));
                });
            }
        }, function (e) {
            alert(e.message);
        });
        return _this;
        //Forecast request
    }
    HelloWorldModel.prototype.setIcons = function () {
        var _this = this;
        var icons = utilities.getIcons([
            'temperature', 'wind', 'cloud',
            'pressure', 'humidity', 'rain',
            'sunrise', 'sunset'
        ]);
        icons.forEach(function (item) {
            _this.set(item.name + "_icon", item.icon);
        });
    };
    return HelloWorldModel;
}(observable_1.Observable));
exports.HelloWorldModel = HelloWorldModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi12aWV3LW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi12aWV3LW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQTZDO0FBQzdDLHNEQUF5RDtBQUN6RCw4Q0FBaUQ7QUFDakQsOENBQWlEO0FBQ2pELHNEQUF5RDtBQUN6RCw4Q0FBaUQ7QUFDakQsK0JBQWtDO0FBR2xDO0lBQXFDLG1DQUFVO0lBSzNDO1FBQUEsWUFDSSxpQkFBTyxTQXVEVjtRQXJERyxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0IsV0FBVyxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDdEMsQ0FBQztRQUVELElBQUksV0FBVyxHQUFHLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUMzQyxLQUFJLENBQUMsR0FBRyxDQUFDLGtCQUFrQixFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQzFDLEtBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUloQixJQUFJLFFBQVEsR0FBRyxXQUFXLENBQUMsa0JBQWtCLENBQUMsRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFDLENBQUM7WUFDL0QsSUFBSSxDQUNGLFVBQUMsR0FBRztZQUNGLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsYUFBYSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDaEMsS0FBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLENBQUM7Z0JBRTdCLElBQUksR0FBRyxHQUFHLEtBQUcsU0FBUyxDQUFDLFdBQVcsR0FBRyxTQUFTLENBQUMsb0JBQW9CLGFBQVEsR0FBRyxDQUFDLFFBQVEsYUFBUSxHQUFHLENBQUMsU0FBUyxnQkFBVyxTQUFTLENBQUMsY0FBZ0IsQ0FBQztnQkFDbEosU0FBUyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMs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QUM7UUFDbkIsQ0FBQyxDQUFDLENBQUM7O1FBRUgsa0JBQWtCO0lBRTFCLENBQUM7SUFFRCxrQ0FBUSxHQUFSO1FBQUEsaUJBU0c7UUFSQyxJQUFJLEtBQUssR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDO1lBQzdCLGFBQWEsRUFBRSxNQUFNLEVBQUUsT0FBTztZQUM5QixVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU07WUFDOUIsU0FBUyxFQUFFLFFBQVE7U0FDcEIsQ0FBQyxDQUFDO1FBQ0gsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFDLElBQUk7WUFDakIsS0FBSSxDQUFDLEdBQUcsQ0FBSSxJQUFJLENBQUMsSUFBSSxVQUFPLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUdQLHNCQUFDO0FBQUQsQ0FBQyxBQTNFRCxDQUFxQyx1QkFBVSxHQTJFOUM7QUEzRVksMENBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAnZGF0YS9vYnNlcnZhYmxlJztcbmltcG9ydCBnZW9sb2NhdGlvbiA9IHJlcXVpcmUoXCJuYXRpdmVzY3JpcHQtZ2VvbG9jYXRpb25cIik7XG5pbXBvcnQgY29uc3RhbnRzID0gcmVxdWlyZShcIi4vY29tbW9uL2NvbnN0YW50c1wiKTtcbmltcG9ydCByZXF1ZXN0b3IgPSByZXF1aXJlKFwiLi9jb21tb24vcmVxdWVzdG9yXCIpO1xuaW1wb3J0IGxvY2F0aW9uU3RvcmUgPSByZXF1aXJlKCcuL3N0b3Jlcy9sb2NhdGlvblN0b3JlJyk7XG5pbXBvcnQgdXRpbGl0aWVzID0gcmVxdWlyZSgnLi9jb21tb24vdXRpbGl0aWVzJyk7XG5pbXBvcnQgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XG5cblxuZXhwb3J0IGNsYXNzIEhlbGxvV29ybGRNb2RlbCBleHRlbmRzIE9ic2VydmFibGUge1xuXG4gICAgcHJpdmF0ZSBfY291bnRlcjogbnVtYmVyO1xuICAgIHByaXZhdGUgX21lc3NhZ2U6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcigpO1xuXG4gICAgICAgIGlmICghZ2VvbG9jYXRpb24uaXNFbmFibGVkKCkpIHtcbiAgICAgICAgICAgIGdlb2xvY2F0aW9uLmVuYWJsZUxvY2F0aW9uUmVxdWVzdCgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciB0aW1lX29mX2RheSA9IHV0aWxpdGllcy5nZXRUaW1lT2ZEYXkoKTtcbiAgICAgICAgICB0aGlzLnNldCgnYmFja2dyb3VuZF9jbGFzcycsIHRpbWVfb2ZfZGF5KTtcbiAgICAgICAgICB0aGlzLnNldEljb25zKCk7XG5cbiAgICAgICAgICBcblxuICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGdlb2xvY2F0aW9uLmdldEN1cnJlbnRMb2NhdGlvbih7dGltZW91dDogMTAwMDB9KS5cbiAgICAgICAgICB0aGVuKFxuICAgICAgICAgICAgKGxvYykgPT4ge1xuICAgICAgICAgICAgICBpZiAobG9jKSB7XG4gICAgICAgICAgICAgICAgbG9jYXRpb25TdG9yZS5zYXZlTG9jYXRpb24obG9jKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldCgnaXNfbG9hZGluZycsIHRydWUpO1xuICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIHVybCA9IGAke2NvbnN0YW50cy5XRUFUSEVSX1VSTH0ke2NvbnN0YW50cy5DVVJSRU5UX1dFQVRIRVJfUEFUSH0/bGF0PSR7bG9jLmxhdGl0dWRlfSZsb249JHtsb2MubG9uZ2l0dWRlfSZhcGlrZXk9JHtjb25zdGFudHMuV0VBVEhFUl9BUElLRVl9YDtcbiAgICAgICAgICAgICAgICByZXF1ZXN0b3IuZ2V0KHVybCkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoJ2lzX2xvYWRpbmcnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIHdlYXRoZXIgPSByZXMud2VhdGhlclswXS5tYWluLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgdmFyIHdlYXRoZXJfZGVzY3JpcHRpb24gPSByZXMud2VhdGhlclswXS5kZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgdGVtcGVyYXR1cmUgPSAocmVzLm1haW4udGVtcCkgLSAyNzMuMTU7XG4gICAgICAgICAgICAgICAgdmFyIGljb24gPSBjb25zdGFudHMuV0VBVEhFUl9JQ09OU1t0aW1lX29mX2RheV1bd2VhdGhlcl07XG4gICAgICBcbiAgICAgICAgICAgICAgICB2YXIgcmFpbiA9ICcwJztcbiAgICAgICAgICAgICAgICAgIGlmKHJlcy5yYWluKXtcbiAgICAgICAgICAgICAgICAgICAgICByYWluID0gcmVzLnJhaW5bJzNoJ107XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0KCdpY29uJywgU3RyaW5nLmZyb21DaGFyQ29kZShpY29uKSk7XG4gICAgICAgICAgICB0aGlzLnNldCgndGVtcGVyYXR1cmUnLCBgJHt1dGlsaXRpZXMuZGVzY3JpYmVUZW1wZXJhdHVyZShNYXRoLmZsb29yKHRlbXBlcmF0dXJlKSl9ICgke3V0aWxpdGllcy5jb252ZXJ0S2VsdmluVG9DZWxzaXVzKHRlbXBlcmF0dXJlKS50b0ZpeGVkKDIpfSDCsEMpYCk7XG4gICAgICAgICAgICB0aGlzLnNldCgnd2VhdGhlcicsIHdlYXRoZXJfZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ3BsYWNlJywgYCR7cmVzLm5hbWV9LCAke3Jlcy5zeXMuY291bnRyeX1gKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KCd3aW5kJywgYCR7dXRpbGl0aWVzLmRlc2NyaWJlV2luZFNwZWVkKHJlcy53aW5kLnNwZWVkKX0gJHtyZXMud2luZC5zcGVlZH1tL3MgJHt1dGlsaXRpZXMuZGVncmVlVG9EaXJlY3Rpb24ocmVzLndpbmQuZGVnKX0gKCR7cmVzLndpbmQuZGVnfcKwKWApO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ2Nsb3VkcycsIGAke3Jlcy5jbG91ZHMuYWxsfSVgKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KCdwcmVzc3VyZScsIGAke3Jlcy5tYWluLnByZXNzdXJlfSBocGFgKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KCdodW1pZGl0eScsIGAke3V0aWxpdGllcy5kZXNjcmliZUh1bWlkaXR5KHJlcy5tYWluLmh1bWlkaXR5KX0gKCR7cmVzLm1haW4uaHVtaWRpdHl9JSlgKTtcbiAgICAgICAgICAgIHRoaXMuc2V0KCdyYWluJywgYCR7cmFpbn0lYCk7XG4gICAgICAgICAgICB0aGlzLnNldCgnc3VucmlzZScsIG1vbWVudC51bml4KHJlcy5zeXMuc3VucmlzZSkuZm9ybWF0KCdoaDptbSBhJykpO1xuICAgICAgICAgICAgdGhpcy5zZXQoJ3N1bnNldCcsIG1vbWVudC51bml4KHJlcy5zeXMuc3Vuc2V0KS5mb3JtYXQoJ2hoOm1tIGEnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgKGUpID0+IHtcbiAgICAgICAgICAgICAgYWxlcnQoZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvL0ZvcmVjYXN0IHJlcXVlc3RcblxuICAgIH1cblxuICAgIHNldEljb25zKCkge1xuICAgICAgICB2YXIgaWNvbnMgPSB1dGlsaXRpZXMuZ2V0SWNvbnMoW1xuICAgICAgICAgICd0ZW1wZXJhdHVyZScsICd3aW5kJywgJ2Nsb3VkJyxcbiAgICAgICAgICAncHJlc3N1cmUnLCAnaHVtaWRpdHknLCAncmFpbicsXG4gICAgICAgICAgJ3N1bnJpc2UnLCAnc3Vuc2V0J1xuICAgICAgICBdKTtcbiAgICAgICAgaWNvbnMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgICAgIHRoaXMuc2V0KGAke2l0ZW0ubmFtZX1faWNvbmAsIGl0ZW0uaWNvbik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICBcbn1cbiJdfQ==