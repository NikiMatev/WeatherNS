"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var observable_1 = require("data/observable");
var geolocation = require("nativescript-geolocation");
var constants = require("./common/constants");
var requestor = require("./common/requestor");
var locationStore = require("./stores/locationStore");
var utilities = require("./common/utilities");
var moment = require("moment");
var HelloWorldModel = /** @class */ (function (_super) {
    __extends(HelloWorldModel, _super);
    function HelloWorldModel() {
        var _this = _super.call(this) || this;
        if (!geolocation.isEnabled()) {
            geolocation.enableLocationRequest();
        }
        var location = geolocation.getCurrentLocation({ timeout: 10000 }).
            then(function (loc) {
            if (loc) {
                locationStore.saveLocation(loc);
                _this.set('is_loading', true);
                var url = "" + constants.WEATHER_URL + constants.CURRENT_WEATHER_PATH + "?lat=" + loc.latitude + "&lon=" + loc.longitude + "&apikey=" + constants.WEATHER_APIKEY;
                requestor.get(url).then(function (res) {
                    _this.set('is_loading', false);
                    var weather = res.weather[0].main.toLowerCase();
                    var weather_description = res.weather[0].description;
                    var temperature = (res.main.temp) - 273.15;
                    console.log(weather);
                    console.log(weather_description);
                    console.log(temperature);
                    var rain = '0';
                    if (res.rain) {
                        rain = res.rain['3h'];
                    }
                });
            }
        }, function (e) {
            alert(e.message);
        });
        //Forecast request
        var locationForecast = locationStore.getLocation();
        var url = "" + constants.WEATHER_URL + constants.WEATHER_FORECAST_PATH + "?cnt=6&lat=" + locationForecast.latitude + "&lon=" + locationForecast.longitude + "&apikey=" + constants.WEATHER_APIKEY;
        var time_of_day = utilities.getTimeOfDay();
        _this.set('is_loading', true);
        _this.set('background_class', time_of_day);
        _this.setIcons();
        requestor.get(url).then(function (response) {
            _this.set('is_loading', false);
            var forecast = _this.getForecast(response);
            _this.set('forecast', forecast);
        });
        return _this;
    }
    HelloWorldModel.prototype.getForecast = function (response) {
        var forecast = [];
        var list = response.list.splice(1);
        list.forEach(function (item) {
            forecast.push({
                day: moment.unix(item.dt).format('MMM DD (ddd)'),
                icon: String.fromCharCode(constants.WEATHER_ICONS['day'][item.weather[0].main.toLowerCase()]),
                temperature: {
                    day: "" + utilities.describeTemperature(item.temp.day),
                    night: "" + utilities.describeTemperature(item.temp.night)
                },
                wind: item.speed + "m/s",
                clouds: item.clouds + "%",
                pressure: item.pressure + " hpa",
                description: item.weather[0].description
            });
        });
        return forecast;
    };
    HelloWorldModel.prototype.setIcons = function () {
        var _this = this;
        var icons = utilities.getIcons(['temperature', 'wind', 'cloud', 'pressure']);
        icons.forEach(function (item) {
            _this.set(item.name + "_icon", item.icon);
        });
    };
    return HelloWorldModel;
}(observable_1.Observable));
exports.HelloWorldModel = HelloWorldModel;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi12aWV3LW1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi12aWV3LW1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQTZDO0FBQzdDLHNEQUF5RDtBQUN6RCw4Q0FBaUQ7QUFDakQsOENBQWlEO0FBQ2pELHNEQUF5RDtBQUN6RCw4Q0FBaUQ7QUFDakQsK0JBQWtDO0FBR2xDO0lBQXFDLG1DQUFVO0lBSzNDO1FBQUEsWUFDSSxpQkFBTyxTQXNEWjtRQXBESyxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDM0IsV0FBVyxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFDdEMsQ0FBQztRQUlELElBQUksUUFBUSxHQUFHLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUMsQ0FBQztZQUMvRCxJQUFJLENBQ0YsVUFBQyxHQUFHO1lBQ0YsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDUixhQUFhLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNoQyxLQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsQ0FBQztnQkFFN0IsSUFBSSxHQUFHLEdBQUcsS0FBRyxTQUFTLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQyxvQkFBb0IsYUFBUSxHQUFHLENBQUMsUUFBUSxhQUFRLEdBQUcsQ0FBQyxTQUFTLGdCQUFXLFNBQVMsQ0FBQyxjQUFnQixDQUFDO2dCQUNsSixTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLEdBQUc7b0JBQzVCLEtBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO29CQUU5QixJQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxX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SyxJQUFJLENBQUMsTUFBTSxNQUFHO2dCQUN6QixRQUFRLEVBQUssSUFBSSxDQUFDLFFBQVEsU0FBTTtnQkFDaEMsV0FBVyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVzthQUN6QyxDQUFDLENBQUE7UUFDSixDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVPLGtDQUFRLEdBQWhCO1FBQUEsaUJBS0M7UUFKQyxJQUFJLEtBQUssR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsYUFBYSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUM3RSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQUMsSUFBSTtZQUNqQixLQUFJLENBQUMsR0FBRyxDQUFJLElBQUksQ0FBQyxJQUFJLFVBQU8sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0Msc0JBQUM7QUFBRCxDQUFDLEFBekZMLENBQXFDLHVCQUFVLEdBeUYxQztBQXpGUSwwQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdkYXRhL29ic2VydmFibGUnO1xuaW1wb3J0IGdlb2xvY2F0aW9uID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1nZW9sb2NhdGlvblwiKTtcbmltcG9ydCBjb25zdGFudHMgPSByZXF1aXJlKFwiLi9jb21tb24vY29uc3RhbnRzXCIpO1xuaW1wb3J0IHJlcXVlc3RvciA9IHJlcXVpcmUoXCIuL2NvbW1vbi9yZXF1ZXN0b3JcIik7XG5pbXBvcnQgbG9jYXRpb25TdG9yZSA9IHJlcXVpcmUoJy4vc3RvcmVzL2xvY2F0aW9uU3RvcmUnKTtcbmltcG9ydCB1dGlsaXRpZXMgPSByZXF1aXJlKCcuL2NvbW1vbi91dGlsaXRpZXMnKTtcbmltcG9ydCBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcblxuXG5leHBvcnQgY2xhc3MgSGVsbG9Xb3JsZE1vZGVsIGV4dGVuZHMgT2JzZXJ2YWJsZSB7XG5cbiAgICBwcml2YXRlIF9jb3VudGVyOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfbWVzc2FnZTogc3RyaW5nO1xuXG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgaWYgKCFnZW9sb2NhdGlvbi5pc0VuYWJsZWQoKSkge1xuICAgICAgICAgICAgZ2VvbG9jYXRpb24uZW5hYmxlTG9jYXRpb25SZXF1ZXN0KCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgXG5cbiAgICAgICAgICB2YXIgbG9jYXRpb24gPSBnZW9sb2NhdGlvbi5nZXRDdXJyZW50TG9jYXRpb24oe3RpbWVvdXQ6IDEwMDAwfSkuXG4gICAgICAgICAgdGhlbihcbiAgICAgICAgICAgIChsb2MpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGxvYykge1xuICAgICAgICAgICAgICAgIGxvY2F0aW9uU3RvcmUuc2F2ZUxvY2F0aW9uKGxvYyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoJ2lzX2xvYWRpbmcnLCB0cnVlKTtcbiAgICAgIFxuICAgICAgICAgICAgICAgIHZhciB1cmwgPSBgJHtjb25zdGFudHMuV0VBVEhFUl9VUkx9JHtjb25zdGFudHMuQ1VSUkVOVF9XRUFUSEVSX1BBVEh9P2xhdD0ke2xvYy5sYXRpdHVkZX0mbG9uPSR7bG9jLmxvbmdpdHVkZX0mYXBpa2V5PSR7Y29uc3RhbnRzLldFQVRIRVJfQVBJS0VZfWA7XG4gICAgICAgICAgICAgICAgcmVxdWVzdG9yLmdldCh1cmwpLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0KCdpc19sb2FkaW5nJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciB3ZWF0aGVyID0gcmVzLndlYXRoZXJbMF0ubWFpbi50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHZhciB3ZWF0aGVyX2Rlc2NyaXB0aW9uID0gcmVzLndlYXRoZXJbMF0uZGVzY3JpcHRpb247XG4gICAgICAgICAgICAgICAgdmFyIHRlbXBlcmF0dXJlID0gKHJlcy5tYWluLnRlbXApIC0gMjczLjE1O1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHdlYXRoZXIpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHdlYXRoZXJfZGVzY3JpcHRpb24pO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRlbXBlcmF0dXJlKTsgIFxuICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIHJhaW4gPSAnMCc7XG4gICAgICAgICAgICAgICAgICBpZihyZXMucmFpbil7XG4gICAgICAgICAgICAgICAgICAgICAgcmFpbiA9IHJlcy5yYWluWyczaCddO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIChlKSA9PiB7XG4gICAgICAgICAgICAgIGFsZXJ0KGUubWVzc2FnZSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy9Gb3JlY2FzdCByZXF1ZXN0XG5cbiAgICAgICAgICAgIHZhciBsb2NhdGlvbkZvcmVjYXN0ID0gbG9jYXRpb25TdG9yZS5nZXRMb2NhdGlvbigpO1xuICAgIHZhciB1cmwgPSBgJHtjb25zdGFudHMuV0VBVEhFUl9VUkx9JHtjb25zdGFudHMuV0VBVEhFUl9GT1JFQ0FTVF9QQVRIfT9jbnQ9NiZsYXQ9JHtsb2NhdGlvbkZvcmVjYXN0LmxhdGl0dWRlfSZsb249JHtsb2NhdGlvbkZvcmVjYXN0LmxvbmdpdHVkZX0mYXBpa2V5PSR7Y29uc3RhbnRzLldFQVRIRVJfQVBJS0VZfWA7XG5cbiAgICB2YXIgdGltZV9vZl9kYXkgPSB1dGlsaXRpZXMuZ2V0VGltZU9mRGF5KCk7XG4gICAgdGhpcy5zZXQoJ2lzX2xvYWRpbmcnLCB0cnVlKTtcbiAgICB0aGlzLnNldCgnYmFja2dyb3VuZF9jbGFzcycsIHRpbWVfb2ZfZGF5KTtcbiAgICB0aGlzLnNldEljb25zKCk7XG5cbiAgICByZXF1ZXN0b3IuZ2V0KHVybCkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgIHRoaXMuc2V0KCdpc19sb2FkaW5nJywgZmFsc2UpO1xuICAgICAgdmFyIGZvcmVjYXN0ID0gdGhpcy5nZXRGb3JlY2FzdChyZXNwb25zZSk7XG4gICAgICB0aGlzLnNldCgnZm9yZWNhc3QnLCBmb3JlY2FzdCk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldEZvcmVjYXN0KHJlc3BvbnNlKSB7XG4gICAgdmFyIGZvcmVjYXN0ID0gW107XG4gICAgdmFyIGxpc3QgPSByZXNwb25zZS5saXN0LnNwbGljZSgxKTtcbiAgICBsaXN0LmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIGZvcmVjYXN0LnB1c2goe1xuICAgICAgICBkYXk6IG1vbWVudC51bml4KGl0ZW0uZHQpLmZvcm1hdCgnTU1NIEREIChkZGQpJyksXG4gICAgICAgIGljb246IFN0cmluZy5mcm9tQ2hhckNvZGUoY29uc3RhbnRzLldFQVRIRVJfSUNPTlNbJ2RheSddW2l0ZW0ud2VhdGhlclswXS5tYWluLnRvTG93ZXJDYXNlKCldKSxcbiAgICAgICAgdGVtcGVyYXR1cmU6IHtcbiAgICAgICAgICBkYXk6IGAke3V0aWxpdGllcy5kZXNjcmliZVRlbXBlcmF0dXJlKGl0ZW0udGVtcC5kYXkpfWAsXG4gICAgICAgICAgbmlnaHQ6IGAke3V0aWxpdGllcy5kZXNjcmliZVRlbXBlcmF0dXJlKGl0ZW0udGVtcC5uaWdodCl9YFxuICAgICAgICB9LFxuICAgICAgICB3aW5kOiBgJHtpdGVtLnNwZWVkfW0vc2AsXG4gICAgICAgIGNsb3VkczogYCR7aXRlbS5jbG91ZHN9JWAsXG4gICAgICAgIHByZXNzdXJlOiBgJHtpdGVtLnByZXNzdXJlfSBocGFgLFxuICAgICAgICBkZXNjcmlwdGlvbjogaXRlbS53ZWF0aGVyWzBdLmRlc2NyaXB0aW9uXG4gICAgICB9KVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZvcmVjYXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBzZXRJY29ucygpIHtcbiAgICB2YXIgaWNvbnMgPSB1dGlsaXRpZXMuZ2V0SWNvbnMoWyd0ZW1wZXJhdHVyZScsICd3aW5kJywgJ2Nsb3VkJywgJ3ByZXNzdXJlJ10pO1xuICAgIGljb25zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuc2V0KGAke2l0ZW0ubmFtZX1faWNvbmAsIGl0ZW0uaWNvbik7XG4gICAgfSk7XG4gIH1cbiAgICB9XG5cbiAgIFxuXG4iXX0=